<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>STEP 5 — Planner Agent</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: #0b0f14;
      color: #e6edf3;
      line-height: 1.6;
      padding: 32px;
    }
    h1, h2, h3 { color: #58a6ff; }
    h1 { border-bottom: 1px solid #30363d; padding-bottom: 12px; }
    section { margin-bottom: 48px; }
    pre { background: #161b22; padding: 16px; border-radius: 8px; overflow-x: auto; }
    code { color: #d2a8ff; }
    .box {
      background: #11161c;
      border: 1px solid #30363d;
      border-radius: 12px;
      padding: 20px;
      margin-top: 16px;
    }
    .warning { color: #ff7b72; font-weight: bold; }
    .truth { color: #7ee787; font-weight: bold; }
  </style>
</head>
<body>

<h1>STEP 5 — Planner Agent</h1>
<p class="truth">Max-Logic • Deterministic Planning • No Execution Yet</p>

<section>
  <h2>1. Position in the Reasoning Pipeline</h2>
  <pre><code>STEP 1 → Intent Truth
STEP 2 → System Context
STEP 3 → Structural Validation
STEP 4 → Inference & Gaps
STEP 5 → Planner (How to act safely?)</code></pre>
  <p>
    STEP 5 is the first step that transforms understanding into action —
    but still performs zero execution.
  </p>
</section>

<section>
  <h2>2. Core Truth</h2>
  <div class="box">
    <p class="warning">Unplanned execution is indistinguishable from chaos.</p>
    <p>
      The Planner Agent exists to create a bounded, testable, reversible plan
      before a single command or line of code is run.
    </p>
  </div>
</section>

<section>
  <h2>3. Inputs</h2>
  <pre><code>Inputs:
- Structured Intent (STEP 1)
- Context Snapshot (STEP 2)
- CrossReferenceReport (STEP 3)
- InferenceReport (STEP 4)</code></pre>
</section>

<section>
  <h2>4. What Planning Means (Strict Definition)</h2>
  <p>
    Planning is the decomposition of an objective into
    ordered, atomic, verifiable steps with explicit preconditions.
  </p>
</section>

<section>
  <h2>5. Internal Architecture</h2>
  <pre><code>Planner Agent
 ├─ Goal Decomposer
 ├─ Step Sequencer
 ├─ Dependency Resolver
 ├─ Risk-Aware Scheduler
 ├─ Rollback Strategist
 └─ Plan Validator</code></pre>
</section>

<section>
  <h2>6. Atomic Step Design</h2>
  <p>
    Each plan step must satisfy all conditions below:
  </p>
  <ul>
    <li>Single responsibility</li>
    <li>Observable result</li>
    <li>Reversible if possible</li>
    <li>No hidden side effects</li>
  </ul>
</section>

<section>
  <h2>7. Dependency & Order Resolution</h2>
  <pre><code>Rules:
- No step may depend on a future step
- Environment setup precedes logic changes
- Validation precedes mutation</code></pre>
</section>

<section>
  <h2>8. Risk-Aware Planning</h2>
  <p>
    Planner adapts plan shape based on risk level.
  </p>
  <pre><code>Low Risk    → Direct steps
Medium Risk → Guarded steps + checks
High Risk   → Dry-run + confirmation + rollback</code></pre>
</section>

<section>
  <h2>9. Rollback Strategy</h2>
  <p>
    Any step that mutates state must define its rollback.
  </p>
  <pre><code>Rollback Examples:
- Git commit checkpoints
- File backups
- Config snapshots</code></pre>
</section>

<section>
  <h2>10. Output Structure</h2>
  <pre><code>ExecutionPlan {
  objective: string
  steps: PlanStep[]
  risk_level: low | medium | high
  required_tools: string[]
  rollback_points: string[]
  validation_checks: string[]
}</code></pre>
</section>

<section>
  <h2>11. Validation Rules</h2>
  <div class="box">
    <ul>
      <li>No execution instructions embedded</li>
      <li>No step without validation</li>
      <li>No high-risk plan without rollback</li>
    </ul>
  </div>
</section>

<section>
  <h2>12. Output Guarantee</h2>
  <p class="truth">
    After STEP 5, the system knows exactly what it will do,
    in which order, and how to recover if something goes wrong.
  </p>
</section>

<section>
  <h2>13. Handoff to STEP 6</h2>
  <pre><code>STEP 5 Output → ExecutionPlan
        ↓
STEP 6 Input → Architect Agent / Executor</code></pre>
</section>

</body>
</html>

